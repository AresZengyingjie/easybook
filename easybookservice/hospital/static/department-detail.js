/*! 2015 Baidu Inc. All Rights Reserved */
define("home/department-detail",["require","common/js/ajax","common/js/pagination"],function(require){return{init:function(e){var t=$("#current-area");if(t.text().length>5)t.html(t.text().substr(0,4)+"...");this.lanchTab("#departTab"),this.initTab();var n=$("#header").data("cover");if(n){var i=this;this.moreInfo(),this.sortHospital(),$(".search_box").children(".area").children("div").css("display","block");$("#header").data("listtype");$(".depart-select").delegate("li","click",function(e){var t=e.target;$(t).attr("data-value"),$(t).parents(".select-detail").attr("data-type");if($(t).parents(".select-detail").find("li").each(function(){$(this).removeClass("select-cur")}),$(t).addClass("select-cur"),1==$(".nav").find(".current").index())i.httpGetHos(1);else if(2==$(".nav").find(".current").index())i.httpGetDoctor(1)}),$(".doctor-order-time").on("click",function(){$(".visit-hover").toggle()}),$(".doctor-visit-ul").delegate("li","click",function(e){var t=$(this);if(e.stopPropagation(),t.is(".date-group"))return void e.preventDefault();$(".doctor-visit-ul").find("li").removeClass("select-cur");var n=$(e.currentTarget);n.addClass("select-cur"),$(".visit-hover").hide(),i.httpGetDoctor(1)}),$("#icon-order-time").hover(function(){},function(){$(".visit-hover").hide()}),i.staticTop(),i.backTop()}},departDetailFlag:!1,initTab:function(){var e=$("#departTab").find(".nav").find(".current").index();if(0==e)$(".nav").find("a").eq(0).click();else if(1==e)$(".nav").find("a").eq(1).click();else if(2==e)$(".nav").find("a").eq(2).click()},departRelative:function(e,t,n){this.httpGetExcelDoctor(e,t),this.relativeHttpHos(e,n)},excelDoctorList:[],excelDoctorDomEvent:function(){var e=this,t=1,n=$("#dictor-list-ul"),i=Math.floor(e.excelDoctorList.length/5)+(e.excelDoctorList.length%5>0);if(t!=i)$("#next-arrow").find("img").attr("src",$(this).data("src")),$("#pre-arrow").find("img").hover(function(){if(1!=t)$(this).css("cursor","pointer"),$(this).attr("src",$(this).data("srchover"))},function(){if(1!=t)$(this).attr("src",$(this).data("src"));else $(this).css("cursor","auto"),$(this).attr("src",$(this).data("gray"))}),$("#next-arrow").find("img").hover(function(){if(t!=i)$(this).css("cursor","pointer"),$(this).attr("src",$(this).data("srchover"))},function(){if(t!=i)$(this).attr("src",$(this).data("src"));else $(this).css("cursor","auto"),$(this).attr("src",$(this).data("gray"))}),$("#pre-arrow").click(function(){if(1==t)return!1;t--;for(var i=1;5>=i;i++)!function(t,i){setTimeout(function(){n.find("li:eq("+(t-1)+")").replaceWith(e.createExcelDoctorDom(5*(i-1)+t))},50*t)}(i,t);if(1==t)$("#pre-arrow").find("img").trigger("mouseleave")}),$("#next-arrow").click(function(){if(t==i)return!1;for(var r=5;r>=1;r--)!function(t,i){setTimeout(function(){n.find("li:eq("+(t-1)+")").replaceWith(e.createExcelDoctorDom(5*i+t))},50*(5-t))}(r,t);if(t++,t==i)$("#next-arrow").find("img").trigger("mouseleave")})},httpGetExcelDoctor:function(e,t){var n=this,i=require("common/js/ajax"),r=$.extend({},e,t);i({url:""+n.api+"/pc/doctor/list",type:"get",datatype:"json",data:r,success:function(e){if(n.departDetailFlag=!0,e&&e.data&&e.data.doctorList)n.excelDoctorList=e.data.doctorList,n.viewExcelDoctor(),n.excelDoctorDomEvent()},error:function(e){}})},createExcelDoctorDom:function(e){var t=this;if(this.excelDoctorList&&e>this.excelDoctorList.length)return $('<li style="display:none;"></li>');var n=[];if(e%5==1)n.push('<li class="doctor-first">');else n.push("<li>");return e--,n.push('<a href="'+decodeURIComponent(t.excelDoctorList[e].link)+'" target="_blank"><img src="'+t.excelDoctorList[e].avatar+'"></a>'),n.push('<div class="doctor-opacity"><p class="skill">擅长:&nbsp;'+t.excelDoctorList[e].skillIndexCut+"</p></div>"),n.push('<p><a target="_blank" href="'+decodeURIComponent(t.excelDoctorList[e].link)+'" alt="'+t.excelDoctorList[e].wholeName+'" title="'+t.excelDoctorList[e].wholeName+'"><span>'+t.excelDoctorList[e].name+'</span></a>&nbsp;<span class="doctor-level">'+t.excelDoctorList[e].medTitle+"</span></p>"),n.push("<p>"+t.excelDoctorList[e].departName+"</p>"),n.push('<p title="'+t.excelDoctorList[e].hospitalName+'">'+t.excelDoctorList[e].hospitalNameCut+"</p>"),n.push('<p class="btn-appoint"><a target="_blank" href="'+decodeURIComponent(t.excelDoctorList[e].link)+'"><span>一键预约</span></a></p>'),n.push("</li>"),$(n.join("")).hover(function(){$(this).css("background-color","#f9f9f9"),$(this).find(".doctor-opacity").css("display","block"),$(this).find(".btn-appoint span").css({"background-color":"#0197f1","border-color":"#0197f1",color:"#fff"})},function(){$(this).css("background-color","#fff"),$(this).find(".doctor-opacity").css("display","none"),$(this).find(".btn-appoint span").css({"background-color":"#fbfbfb",color:"#333","border-color":"#e8e8e8"})})},viewExcelDoctor:function(){if(this.excelDoctorList.length<=0)return void $("#excel-doctor-div").remove();else $("#excel-doctor-div").show();for(var e=$("#dictor-list-ul"),t=1;5>=t;t++){var n=this.createExcelDoctorDom(t);e.append(n)}},src:function(){var e=$(".footer-box").data("src");return e}(),href:function(){var e=$(".footer-box").data("href");return e}(),api:function(){var e=$(".footer-box").data("api");return e}(),httpDocFlag:!1,httpHosFlag:!1,httpGetDoctor:function(e){var t=this,n=require("common/js/ajax"),i=require("common/js/pagination"),r=t.getFilterData();r.page=e,r.searchType="doctor",r.medTitle=$("#medtitle-ul").find(".select-cur").attr("data-value"),r.medTitle="undefined"!=typeof r.medTitle?r.medTitle:"",r.departLevel2Id=$("#depart-level1-ul").find(".select-cur").attr("data-value"),r.departLevel2Id="undefined"!=typeof r.departLevel2Id?r.departLevel2Id:"",r.departLevel1Id=$("#depart-level1-ul").find(".select-cur").attr("data-level1Id"),r.departLevel2Id="undefined"!=typeof r.departLevel2Id?r.departLevel2Id:"",n({url:""+t.api+"/pc/doctor/list",type:"get",data:r,success:function(n){var r=n.data;if(t.httpDocFlag=!0,t.viewDoctorList(r),n.data.total)new i({total:n.data.total,pageSize:10,curPage:e,pagerContainer:$(".doctor-pagers"),callback:function(e){t.httpGetDoctor(e),t.pageEvent()}}).init()},error:function(e){}})},httpGetHos:function(e){var t=this,n=require("common/js/ajax"),i=require("common/js/pagination"),r=t.getFilterData();if(r.page=e,r.searchType="hospital",r.pageSize=10,r.hospitalType=$(".hospital-type").find(".select-cur").attr("data-value"),r.hospitalLvl=$(".hospital-level").find(".select-cur").attr("data-value"),"region"==$("#region").attr("data-place"))r.regionId=$("#region").find(".select-cur").attr("data-value");else if("city"==$("#region").attr("data-place"))r.cityId=$("#region").find(".select-cur").attr("data-value");r.sortType=$(".hospital-sort").find(".sort-cur").attr("data-value"),r.isInsurance=$(".hospital-sort").find("input").length>0?1==$(".hospital-sort").find("input")[0].checked?1:0:"",r.hospitalType="undefined"!=typeof r.hospitalType?r.hospitalType:"",r.hospitalLvl="undefined"!=typeof r.hospitalLvl?r.hospitalLvl:"",r.regionId="undefined"!=typeof r.regionId?r.regionId:"",r.sortType="undefined"!=typeof r.sortType?r.sortType:"",r.isInsurance="undefined"!=typeof r.isInsurance?r.isInsurance:"",n({url:""+t.api+"/pc/doctor/list",type:"get",data:r,success:function(n){var r=n.data;if(t.httpHosFlag=!0,t.viewHospitalList(r),n.data.total)new i({total:n.data.total,pageSize:10,curPage:e,pagerContainer:$(".hospital-pagers"),callback:function(e){t.httpGetHos(e),t.pageEvent()}}).init()},error:function(e){}})},createDoctorStr:function(e,t){for(var n=this,i=e.length,r=0;i>r;r++){if(t.push('<li class="doctor-info-single">'),t.push('<div class="doctor-card clearfix">'),t.push('<div class="info-pic"><a href="'+e[r].link+'" target="_blank" ><img src="'+e[r].avatar+'"></div>'),t.push('<div class="infos">'),t.push('<div class="info-title" style="margin-top:-10px\x00">'),t.push('<a href="'+e[r].link+'"  target="_blank" alt="'+e[r].wholeName+'" title="'+e[r].wholeName+'"><div>'+e[r].name+"</div></a>"),0!=e[r].isVerify)t.push('<a href="'+e[r].verifyLink+'" target="_blank"><i><img src="'+n.src+'/common/img/fill_icon_doctor-yi.png"/></i><span>百度认证医生</span></a>');if(t.push('<span class="doctor-medtitle">'+e[r].medTitle+"</span><span>"+e[r].eduTitle+"</span>"),t.push('<p class="info-hospittal"><span><a href="'+e[r].hospitalLink+'" target="_blank" >'+e[r].hospitalName+"</a></span>"+e[r].departName+"</p>"),t.push("<table cellSpacing=0 cellPadding=0>"),t.push('<tr class="doctor-good">'),t.push('<td class="first-td" valign="top">擅长诊治: </td>'),t.push('<td class="last-td" valign="top">'+e[r].skill+"</td>"),t.push("</tr>"),t.push("</table>"),t.push('<div class="rate">'),e[r].star>0){t.push("<span>总推荐度：</span>"),t.push('<div class="grade-star">');for(var a=0;a<e[r].star;a++)t.push('<i class="star star-light"></i>');for(var a=e[r].star;5>a;a++)t.push('<i class="star star-gray"></i>');t.push("</div>")}t.push('<span>预约成功率：</span><i class="num">'+e[r].reservedRate+"</i>"),t.push("</div>"),t.push("</div>"),t.push("</div>"),t.push('<div class="appointment-time"><ul>');var o=e[r].appointTime.timeList;if(0==o.length)t.push("<li>已约满，每<em>半小时</em>更新号源，敬请关注。</li>");else for(var a=0;a<o.length;a++)t.push("<li>"),t.push('<span class="appointment-day">'+o[a].dateDesc+"</span>"),t.push("<span>"+o[a].date+"</span>"),t.push("<span>"+o[a].interval+"</span>"),t.push('<a href="'+o[a].buttonLink+'" target="_blank"><span class="appointment-click">'+o[a].buttonText+"</span></a>"),t.push("</li>");if(""!=e[r].appointTime.moreLink)t.push('<li><a href="'+e[r].appointTime.moreLink+'" class="more-time-chose" target="_blank"><span >更多时段&nbsp;></span></li></a>');t.push("</ul></div>"),t.push("</div>"),t.push("</li>")}},viewDoctorList:function(e){var t=this;$("#doc_total").html(e.total);var n=[],i=e.doctorList.length;if(0>=i)$(".main").find(".content").eq(2).find(".pagination-x").hide(),$(".doctor-info-list").hide(),$(".doctor-empty").show();else{$(".doctor-empty").hide(),$(".doctor-info-list").show(),$(".main").find(".content").eq(2).find(".pagination-x").show(),t.createDoctorStr(e.doctorList,n),$("#doctor-info-list").html(n.join("")).show();var r=parseInt(i/10);if(0==r)$("#doctor-info-list").find(".doctor-info-single").eq(-1).css("border-bottom-color","#fff")}},viewHospitalList:function(e){var t=[];$("#hos_total").html(e.total);var n=e.hospitalList?e.hospitalList.length:0;if(0>=n)$(".hospital-list").hide(),$(".main").find(".content").eq(1).find(".pagination-x").hide(),$(".hospital-empty").show();else{$(".hospital-empty").hide(),$(".hospital-list").show(),$(".main").find(".content").eq(1).find(".pagination-x").show();for(var i=0;n>i;i++){if(t.push('<li class="hospital-info-li">'),t.push('<div class="hospital-info">'),t.push('<div class="hospital-pic"><a href="'+e.hospitalList[i].link+'" target="_blank"><img src="'+e.hospitalList[i].logo+'"></a></div>'),t.push('<div class="hospital-introduces">'),t.push('<div class="introduces-title"><a href="'+e.hospitalList[i].link+'" target="_blank">'+e.hospitalList[i].name+"</a>"),e.hospitalList[i].level)t.push('<span class="hospital-sign">'+e.hospitalList[i].level+"</span>");if(1==e.hospitalList[i].insurance)t.push('<span class="hospital-health">医保</span>');if(t.push("</div>"),t.push("<table cellSpacing=0 cellPadding=0>"),t.push("<tr>"),t.push('<td valign="top">医院地址: </td>'),t.push('<td class="info-pos">'+e.hospitalList[i].address+'<a href="'+e.hospitalList[i].routeLink+'" class="marker" target="_blank"><i class="fa fa-map-marker"></i>查看地图</a></td>'),t.push("</tr>"),t.push("<tr>"),1==e.hospitalList[i].serviceGuahao||1==e.hospitalList[i].serviceTixing){if(t.push('<td valign="bottom">提供服务: </td>'),t.push('<td valign="bottom" class="server">'),1==e.hospitalList[i].serviceGuahao)t.push("预约挂号");if(1==e.hospitalList[i].serviceTixing)t.push("&nbsp;/&nbsp;就诊提醒");t.push("</td>")}else;t.push("</tr>"),t.push("</table>"),t.push("<label>可挂号医生<i>"+e.hospitalList[i].doctorNum+"</i>个<span> | </span>有<i>"+e.hospitalList[i].serveNum+"</i>人网上预约</div></label>"),t.push("</div>"),t.push("</div>"),t.push("</li>")}$("#hospital-list-ul").html(t.join(""));var r=parseInt(n/10);if(0==r)$("#hospital-list-ul").find("li").eq(-1).css("border-color","#fff")}},lanchTab:function(e){var t=this,n=$(e),i="current";n.on("click",".hd",function(){var e=$(this).data("tab"),r=$(this).addClass(i).siblings().removeClass(i).end().index();if(n.find(".content").eq(r).show().siblings().hide(),"doctor"==e){if(0==t.httpDocFlag)t.httpGetDoctor(1)}else if("hospital"==e){if(0==t.httpHosFlag)t.httpGetHos(1);t.pageEvent()}else if("depart"==e)if(0==t.departDetailFlag)t.departRelative(t.getFilterData(),{pageSize:15,searchType:"doctor",regionId:""},{pageSize:8,searchType:"hospital",regionId:""});if($(".nav").hasClass("static-top"))$(window).scrollTop(t.scroll),n.find(".content").eq(r).css("margin-top","58px")})},getFilterData:function(){var e={};if(e.listType=$("#header").data("listtype"),e.key=$("input[name='key']").attr("data-value"),e.cityId=$("#city-list").find(".current-select").attr("data-value"),1==$("#current-area").attr("data-provTag"))e.provId=$("#current-area").attr("data-provId");else e.provId=$("#city-list").find(".current-select").attr("data-provId");if(e.date=$("#select-visit-time").find(".select-cur").attr("data-value"),e.departLevel1Id="",e.departLevel2Id="",e.medTitle="",e.regionId="",e.key="undefined"!=typeof e.key?e.key:"",e.provId="undefined"!=typeof e.provId?e.provId:"",e.cityId="undefined"!=typeof e.cityId?e.cityId:"",e.date="undefined"!=typeof e.date?e.date:"",e.listType="undefined"!=typeof e.listType?e.listType:"",paramdata=$("#header").data("paramdata"),paramdata)for(var t in paramdata)e[t]=paramdata[t];return e},backTop:function(){var e=$(".footer-box").height();$(window).scroll(function(){var t=$(this).scrollTop(),n=$(document).height(),i=$(this).height();if($(window).scrollTop()>30)$("#feedback").show();else if($(window).scrollTop()<30)$("#feedback").hide();var r=n-(t+i);if(e>=r)$("#feedback").css("bottom",e-r+15+"px");else $("#feedback").css("bottom","20px")}),$("#back-top").click(function(){return $("html,body").animate({scrollTop:"0px"},500),$(this).blur(),!1}),$("#back").click(function(){$(this).blur()}),$("#feedback").find("img").mouseenter(function(){$(this).attr("src",$(this).data("srchover"))}),$("#feedback").find("img").mouseleave(function(){$(this).attr("src",$(this).data("src"))})},moreInfo:function(){$(".more-hos").click(function(){if(1==$(this).attr("data-type"))$(".nav").find("a").eq(2).click();else if(2==$(this).attr("data-type"))$(".nav").find("a").eq(1).click()})},staticTop:function(){var e=this,t=e.scroll;$(window).load(function(){var e=$(this).scrollTop();if(e>=t)$(".nav").addClass("static-top");else if(t>e)$(".header").show(),$(".index-title").show(),$(".depart-title").show(),$(".nav").removeClass("static-top"),$(".content").css("margin-top","10px")}),$(window).scroll(function(){var e=$(this).scrollTop();if($(".nav").hasClass("static-top")){var n=$(".nav").find(".current").index();if(e<$(".main").find(".content").eq(n).attr("data-margin"))$(".content").css("margin-top",e+"px")}if(!$(".nav").hasClass("static-top")&&e>=t)$(".nav").addClass("static-top");else if($(".nav").hasClass("static-top")&&t>e)$(".header").show(),$(".index-title").show(),$(".depart-title").show(),$(".nav").removeClass("static-top"),$(".content").css("margin-top","10px")})},sortHospital:function(){var e=this;$(".hospital-sort").delegate("span","click",function(t){var n=t.target;if(1==$(this).index())$(this).html("预约量从高到低"),$(this).addClass("sort-cur").siblings("span").removeClass("sort-cur");else if(0==$(this).index())$(".hospital-sort").find("span").eq(1).html("预约量"),$(this).addClass("sort-cur").siblings("span").removeClass("sort-cur");else if(2==$(this).index())if(n.innerHTML==$(".medical-care").attr("data-value"))if(1==$(this).find("input")[0].checked)$(this).find("input")[0].checked=!1;else $(this).find("input")[0].checked=!0;e.httpGetHos(1)})},pageEvent:function(){$(".pagination-x-list").find("li").length;$(".pagination-x-list").delegate("li","click",function(){if(0!==$(this).index()||$(this).index()!==$(".pagination-x-list").find("li").last().index())$("#fastTop").show()})},relativeHttpHos:function(e,t){var n=this,i=require("common/js/ajax"),r=$.extend({},e,t);i({url:""+n.api+"/pc/doctor/list",type:"get",data:r,success:function(e){var t=e.data;n.relativeHos(t),n.departDetailFlag=!0},error:function(e){}})},relativeHos:function(e){var t=this,n=[],i=e.hospitalList?e.hospitalList.length:0;if(!(0>=i)){$("#excel-hos-div").show();for(var r=0;i>r;r++){if(r%4==3)n.push('<li class="hospital-detail content-last">');else n.push('<li class="hospital-detail">');if(n.push('<a href="'+e.hospitalList[r].link+'" target="_blank"><img src="'+e.hospitalList[r].logo+'" width="230" height="120"></a>'),n.push('<p class="hospital-name">'),n.push('<a href="'+e.hospitalList[r].link+'" target="_blank" title="'+e.hospitalList[r].name+'" target="_blank"><span class="span-name">'+e.hospitalList[r].name+"</span></a>"),n.push('<label class="hospital-grade">'),e.hospitalList[r].level)n.push(' <span class="grade">'+e.hospitalList[r].level+"</span>");if(1==e.hospitalList[r].insurance)n.push('<span class="corpt">医保</span>');n.push("</label></p>"),n.push('<p class="appointent_total"><label class="label-left">'+e.hospitalList[r].doctorNum+'位可挂号医生</label><label class="label-right"><span>'+e.hospitalList[r].serveNum+"</span>人成功预约</label></p><li>")}$("#doctor_content").append(n.join(""))}else if($("#excel-hos-div").remove(),t.excelDoctorList.length<=0)$("#more-excel").remove()}}});