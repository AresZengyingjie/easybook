/*! 2015 Baidu Inc. All Rights Reserved */
define("doctor/detail",["require","common/js/ajax","common/js/pagination","common/js/mustache.min","common/js/config","common/js/moudle"],function(require){return{tmpl:function(){return $("#listTmpl").html()}(),commentContainer:function(){return $("#commentList")}(),totalEcho:function(){return $("#totalEcho")}(),init:function(){this.checkSchedule(),this.getCommentList(1),this.getSimilarDoctorList(),this.addDomEvent(),$(".city-index span").on("click",function(){$(".city-list div").hide().eq($(".city-index span").removeClass("border-bottom3px").index($(this).attr("class","border-bottom3px"))).show()}),$(".area-border").on("mouseenter",function(){$(this).find(".city-index").find("span").attr("class","border-bottom1px"),$(this).find(".city-list").find("div").hide();var e=$(".select-city").find(".city-index").data("index");$(this).find(".city-index").find("span").eq(e).attr("class","border-bottom3px"),$(this).find(".city-list").find("div").eq(e).show(),$(this).css("border-color","#eaeaea").find(".select-city").show()}).on("mouseleave",function(){$(this).css("border-color","#ffffff").find(".select-city").hide(),$(".city-index span:eq(0)").trigger("click")})},addDomEvent:function(){var e=609,t=this.scheduleCurrentIndex,n=-e*(t-1)+4,i=""==this.scheduleDayCount?0:parseInt(this.scheduleDayCount),r=Math.ceil(i/7);$(".schedule-main-outer .schedule").css("width",r*e);var o=$(".arrow-bar");if(1==r||r==t)$(".right-arrow-bar").addClass("disabled");$("#f").css({"margin-left":n+"px"}),o.off("click").on("click",function(i){i.stopPropagation();var a=$(this);if(a.is(".disabled"))return void i.preventDefault();if(a.is(".right-arrow-bar")&&t>0){if(n-=e,o.filter(".left-arrow-bar").removeClass("disabled"),$("#f").animate({"margin-left":n},500,"linear",function(){}),t++,t===r)a.addClass("disabled")}else if(a.is(".left-arrow-bar")&&r+1>t)if(n+=e,$("#f").animate({"margin-left":n},500,"linear",function(){}),t--,o.filter(".right-arrow-bar").removeClass("disabled"),1===t)a.addClass("disabled"),$("#f").animate({"margin-left":2},0)})},getCommentList:function(e){var t=this,n=6,i=require("common/js/ajax"),r=require("common/js/pagination"),o=require("common/js/mustache.min");i({url:""+t.api+"/pc/evaluation/listonedoc",type:"GET",datatype:"json",data:{doctorId:t.doctorId,page:e,pageSize:n,term:t.term},success:function(n){if(0==n.status){if(n=n.data,n.commentList&&n.commentList.length){$(".comment-header").show(),t.totalEcho.html(n.total),$(".evaluation-total").html("（"+n.total+"评价）");for(var i=n.commentList,a=i.length,s=null,l=0;a>l;++l)if(s=i[l],s.replyList&&s.replyList.length)s.hasCommment=!0;s=null}else t.totalEcho.html("暂无评价"),$(".evaluation-total").remove(),$("#comment-total").remove();t.commentContainer.html(o.render(t.tmpl,n));var u=new r({total:n.total,pageSize:n.pageSize,curPage:e,pagerContainer:$(".pagers"),callback:function(e){t.getCommentList(e),u=null}});u.init()}},error:function(){$("#comment-total").remove()}})},src:function(){var e=$(".footer-box").data("src");return e}(),href:function(){var e=$(".footer-box").data("href");return e}(),api:function(){var e=$(".footer-box").data("api");return e}(),getSimilarDoctorList:function(){var e=this,t=require("common/js/ajax");t({url:""+e.api+"/pc/doctor/recommend",type:"GET",datatype:"json",data:{doctorId:e.doctorId,hospital:e.hospital,department:e.department,count:5},success:function(t){if(0==t.status)e.createSimilarDoctorList(t.data.doctorList);else $("#recommend").remove()},error:function(){$("#recommend").remove()}})},createSimilarDoctorList:function(e){var t=require("common/js/config"),n=[];if(e.length<=0)return void $("#recommend").remove();for(var i=0;i<e.length;i++){var r=e[i].name,o=t.subTitle(r,3);n.push("<li>"),n.push('<div class="rec-pic"><a href="'+e[i].link+'" target="_blank"><img src="'+e[i].avatar+'"></a></div>'),n.push('<div class="rec-info">'),n.push("<p>"),n.push('<span><a href="'+e[i].link+'" target="_blank" title='+e[i].name+">"+o+"</a></span>");var r="";r+=e[i].medTitle,n.push("<span>&nbsp"+r+"</span>"),n.push('<p class="hospital">'+e[i].hospitalName+"</p>"),n.push("</div>"),n.push("</li>")}$(".recommend-content").html(n.join(""))},getDisplayStarNum:function(e){var t=Math.floor(e);if(t+1-.2>e)return t>5?5:t;else return displayNum=t+1>5?5:t+1,displayNum},keyParamer:function(e){var t="";for(var n in e)t+='<input type="hidden" name="'+n+'" value="'+e[n]+'" />';$('input[name="key"]').after(t),$("#med_form").attr("action",""+this.api+"/pc/search/list").submit()},keyWord:function(e){var t=this;$("#querySearch").on("click",function(){t.keyParamer(e)}),$("#querySearch").on("keydown",function(n){var i=n.which;if(13==i)return t.keyParamer(e),!1;else return void 0}),$("input[name='key']").on("keydown",function(n){var i=n.which;if(13==i)return t.keyParamer(e),!1;else return void 0})},animation:function(e,t){if(1==e){var n=require("common/js/moudle"),module=new n({path:t});module.init(),$(document).on("click",function(){module.remove()})}},checkSchedule:function(){if($(".schedule .opening").length<=0)$("#select-patient-time").html("选择就诊时间<span>（已约满，每<i>半小时</i>更新号源，敬请关注。）</span>")}}});