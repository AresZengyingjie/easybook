/*! 2015 Baidu Inc. All Rights Reserved */
define("order/order",["common/js/ajax","order/validate"],function(){function e(e){var t=[];if(t.push('<div class="info-pic"><img src="'+e.avatar+'"></div>'),t.push('<div class="infos">'),t.push('<div class="info-title"><div>'+e.name+"</div>"),1==e.isVerify)t.push("<i></i><span>百度认证医生</span>");t.push("</div>"),t.push('<p class="info-job"><span>'+e.medTitle+"</span>"+e.eduTitle+"</p>"),t.push('<p class="info-hospittal"><span>'+e.hospitalName+"</span>"+e.departName+"</p>"),t.push('<p class="info-pos"><span>医院地址：</span>'+e.position+"</p>"),t.push("</div>");for(var i=e.appointmentTime,n=0;n<i.length;n++)if(exports.treatTime==i[n].date){exports.day=i[n].day;var a=1==exports.treatInterval?"上午":2==exports.treatInterval?"下午":3==exports.treatInterval?"晚上":"";t.push('<div class="info-time"><span>就诊时间：</span>'+exports.treatTime+"("+exports.day+")"+a+"</div>");break}$(".doctor-info").html(t.join(""))}function t(){if(!n())s("#submit-order",t,!1);else{for(var e=require("common/js/ajax"),i=[],a=0;a<exports.img.length;a++)if(exports.img[a]&&exports.img[a].flag)i.push(exports.img[a].smallImg+"|"+exports.img[a].bigImg);if(0==exports.status){var r=localStorage.getItem("isPopLogin"),o=localStorage.getItem("isPopForm");if(r||o)localStorage.removeItem("isPopLogin");if(void 0==exports.visitType)exports.visitType=0;return exports.pics=i,l(exports),void localStorage.setItem("isPopForm",!0)}var c={};if("hdf"==exports.siteFrom)c.province=exports.cityList[exports.currentSelectProvinceIndex].name,c.city=exports.cityList[exports.currentSelectProvinceIndex].children[exports.currentSelectCityIndex].name,c.isTreated=$("#treat-radio")[0].checked?1:0,c.siteFrom="hdf";var u="";if("edit"==exports.op){if(u=""+exports.api+"/pc/appointment/modify",c.aptId=exports.aptId,c.pics=i.join(","),c.visitType=exports.visitType,exports.needCard)c.visitCard=function(){var e=$("#patient-id-card").val();if("若有该医院就诊卡，请填写；若无，可到医院办理。"==e)e="";return e}();if(exports.needCardPassword)c.visitCardPassword=exports.rsa.encryptRsaKey($("#patient-id-card-password").val()).replace(/[\n\r]/g,"");if(1==exports.displayDisDesc)c.diseaseDesc=$("#condition").val();c.term="pc",c.name=status?exports.nowPatientList[exports.nowSelectedPatient].name:$("#patient-name").val(),c.phone=$("#phone-number").val(),c.identification=status?exports.nowPatientList[exports.nowSelectedPatient].identification:$("#id-card").val(),c.patientId=exports.nowPatientList[exports.nowSelectedPatient].patientId}else{if(u=""+exports.api+"/pc/appointment/add",c.pics=i.join(",")||exports.pics,c.visitType=exports.visitType||0,exports.needCard)c.visitCard=function(){var e=$("#patient-id-card").val();if("若有该医院就诊卡，请填写；若无，可到医院办理。"==e)e="";return e}();if(exports.needCardPassword)c.visitCardPassword=exports.rsa.encryptRsaKey($("#patient-id-card-password").val()).replace(/[\n\r]/g,"");if(1==exports.displayDisDesc)if("hdf"==exports.siteFrom)c.diseaseDesc=($("#disease-name").val()+";"+$("#condition").val()).substr(0,300);else c.diseaseDesc=$("#condition").val();if(c.doctorId=exports.doctorId,c.term="pc",c.treatTime=exports.treatTime,c.treatInterval=exports.treatInterval,c.phone=$("#phone-number").val(),void 0!=exports.nowPatientList[exports.nowSelectedPatient])c.patientId=exports.nowPatientList[exports.nowSelectedPatient].id;else c.name=$("#patient-name").val(),c.identification=$("#id-card").val()}e({url:u,type:"POST",async:!1,data:c,success:function(e){if(0==e.status){if("add"==exports.op)if(e.data.sucUrl)localStorage.clear(),location.href=e.data.sucUrl;else{if(url="",e.data.reason)reason=e.data.reason,url=e.data.errorUrl;else reason=e.statusInfo;if($(".popwin-info p").html(reason),""!=url)disStr="确定";else disStr="返回";$(".popwin-info input").val(disStr).data("url",url),$(".popwin-info").show()}else if(void 0==e.data.errorUrl&&void 0!=e.data.detailUrl)$(".popwin-info p").html("您的预约单已修改完成"),$(".popwin-info input").val("确定").data("url",e.data.detailUrl),$(".popwin-info").show();else if(e.data.errorUrl){if(e.data.reason)reason=e.data.reason,url=e.data.errorUrl;else reason=e.statusInfo;if($(".popwin-info p").html(reason),""!=url)disStr="确定";else disStr="返回";$(".popwin-info input").val(disStr).data("url",url),$(".popwin-info").show()}}else if(e.statusInfo)$(".popwin-info p").html(e.statusInfo),$(".popwin-info input").val("返回").data("url",""),$(".popwin-info").show()},error:function(){}})}}function n(){var e=!0;if(1==exports.status&&0!=exports.nowPatientList.length&&-1==exports.nowSelectedPatient&&"edit"!=exports.op)return!1;if(0==exports.status||0==exports.nowPatientList.length&&"edit"!=exports.op){var t=f();e=e&&t;var i=p();e=e&&i}var n=h();if(e=e&&n,0<exports.needCard){var a=m();e=e&&a}if(1==exports.needCardPassword){var r=g();e=e&&r}if(1==exports.displayDisDesc){var o=y();e=e&&o}if(e=e&&$("#agreement").is(":checked"),0==$("#agreement").is(":checked"))$(".widget-wrong").show();else $(".widget-wrong").hide();if("hdf"==exports.siteFrom){if(e=e&&!(-1==exports.currentSelectCityIndex||-1==exports.currentSelectProvinceIndex),-1==exports.currentSelectCityIndex||-1==exports.currentSelectProvinceIndex)$(".city-wrong").show();if("add"==exports.op)e=v()&&e}return e}function a(e,t,i,n){if(t)e.parent().find(".right").show(),e.parent().find(".wrong").hide();else e.parent().find(".right").hide(),i.html(n),e.parent().find(".wrong").show()}function r(){$("#patient-list li").not(":last").detach(),b.getPatientList(function(e){var t=e.data;if(exports.nowPatientList=t,void 0!=t[0])exports.nowSelectedPatient=0;for(var i=0;i<t.length;i++){var n=$('<li class="card-person-err"><span></span></li>');if(0==i)var n=$('<li class="card-person-suc"><span></span></li>');var a=$("<div></div>");if(a.append("<p>"+t[i].name+"</p>"),a.append("<p>"+t[i].identification+"</p>"),n.append(a),$('<i class="right instant-state fa fa-check-circle"></i>').appendTo(n),function(e){n.on("click",function(){var t=$(this);t.parent().find(".card-person-suc").removeClass().addClass("card-person-err"),t.removeClass("card-person-err").addClass("card-person-suc"),exports.nowSelectedPatient=e})}(i),i>=3)n.hide();$(".card-person-add").before(n)}if(0==t.length)$("#patient-name").show(),$("#widget-card").remove(),$("#id-card-tr").show().find("#id-card").show();else $("#patient-name").remove(),$("#id-card-tr").remove(),$("#widget-input-name").remove();if(exports.nowPatientList.length<=3)$("#arrow-down").hide();else $("#arrow-down").show();$("#arrow-up").hide()})}function o(e){for(var t=e.selectedAppointTimeIndex,e=e.appointTime,i=$("#order-time-list"),n=[],a=e.length,r="block",o=0;a>o;o++){if(o>5)r="none";var s='<li style="display:'+r+'"><div><span class="date white" key='+e[o].date.code+">"+e[o].date.text+'</span><span class="white">'+e[o].day+'</span><span class="interval" key='+e[o].interval.code+">"+e[o].interval.text+'</span></div><i class="actived_ico"></i></li>';n.push(s)}if(i.append(n.join("")),i.find("li").eq(t).addClass("actived"),exports.treatTime=e[t].date.code,exports.treatInterval=e[t].interval.code,6>=a)$(".arrowico").hide();i.find("li").on("click",function(){i.find("li").removeClass("actived"),$(this).addClass("actived"),exports.treatTime=$(this).find(".date").attr("key"),exports.treatInterval=$(this).find(".interval").attr("key")}),$(".order-wrap .arrowico").on("click",function(){var e=$(this).find("i").hasClass("fa-sort-desc");if(e)i.find("li").show(),$(this).find("span").text("收起"),$(this).find("i").removeClass("fa-sort-desc").addClass("fa-sort-asc");else{$(this).find("span").text("展开"),$(this).find("i").removeClass("fa-sort-asc").addClass("fa-sort-desc");for(var t=i.find("li"),n=t.length,a=0;n>a;a++)if(a>5)$(t[a]).hide()}})}function s(e,t,i){var n=$(e);if(!n.hasClass("action")&&i)n.addClass("action"),n.on("click",t)}function l(e){c(e),showLoginPop(u)}function c(e){localStorage.setItem("name",$("#patient-name").val()),localStorage.setItem("idcard",$("#id-card").val()),localStorage.setItem("cellphone",$("#phone-number").val());var t=$("#patient-id-card").val()||"";if(localStorage.setItem("visitcard",t),localStorage.setItem("diseasedesc",$("#condition").val()),void 0!=exports.img[0])localStorage.setItem("pic1_small",exports.img[0].smallImg),localStorage.setItem("pic1_big",exports.img[0].bigImg);if(void 0!=exports.img[1])localStorage.setItem("pic2_small",exports.img[1].smallImg),localStorage.setItem("pic2_big",exports.img[1].bigImg);if(void 0!=exports.img[2])localStorage.setItem("pic3_small",exports.img[2].smallImg),localStorage.setItem("pic3_big",exports.img[2].bigImg);if(void 0!=exports.img[3])localStorage.setItem("pic4_small",exports.img[3].smallImg),localStorage.setItem("pic4_big",exports.img[3].bigImg);if(void 0!=exports.img[4])localStorage.setItem("pic5_small",exports.img[4].smallImg),localStorage.setItem("pic5_big",exports.img[4].bigImg);localStorage.setItem("agree","checked"),localStorage.setItem("sub_pics",e.pics.join(","))}function u(){ajaxUrl=""+exports.api+"/pc/appointment/add";for(var e=[],t=0;t<exports.img.length;t++)if(void 0!=exports.img[t].smallImg&&void 0!=exports.img[t].bigImg)e.push(exports.img[t].smallImg+"|"+exports.img[t].bigImg);if(ajaxData={},"hdf"==exports.siteFrom)ajaxData.province=exports.cityList[exports.currentSelectProvinceIndex].name,ajaxData.city=exports.cityList[exports.currentSelectProvinceIndex].children[exports.currentSelectCityIndex].name,ajaxData.isTreated=$("#treat-radio")[0].checked?1:0,ajaxData.siteFrom="hdf";if(ajaxData.pics=e.join(",")||"",ajaxData.visitType=exports.visitType||0,exports.needCard)ajaxData.visitCard=function(){var e=$("#patient-id-card").val();if("若有该医院就诊卡，请填写；若无，可到医院办理。"==e)e="";return e}();if(exports.needCardPassword)ajaxData.visitCardPassword=exports.rsa.encryptRsaKey($("#patient-id-card-password").val()).replace(/[\n\r]/g,"");if(1==exports.displayDisDesc)if("hdf"==exports.siteFrom)ajaxData.diseaseDesc=($("#disease-name").val()+";"+$("#condition").val()).substr(0,300);else ajaxData.diseaseDesc=$("#condition").val();ajaxData.doctorId=exports.doctorId,ajaxData.treatTime=exports.treatTime,ajaxData.treatInterval=exports.treatInterval,ajaxData.name=$("#patient-name").val(),ajaxData.phone=$("#phone-number").val(),ajaxData.identification=$("#id-card").val();var i=require("common/js/ajax");i({url:ajaxUrl,type:"POST",datatype:"json",async:!1,data:ajaxData,success:function(e){if("data"in e&&"sucUrl"in e.data)localStorage.clear(),location.href=e.data.sucUrl;else{if(url="","data"in e&&"reason"in e.data)reason=e.data.reason,url=e.data.errorUrl;else reason=e.statusInfo;failUrl="/pc/appointment/orderResult?type=fail&reason="+reason+"&url="+encodeURIComponent(window.location.href),window.location=failUrl}},error:function(){}})}function d(){}function f(){var e=$("#patient-name");if(rightOrWrong=!1,tips="",1==b.isEmptyName(e[0])||void 0==e[0].name)tips="请输入姓名";else if(1==b.isWrongName(e[0]))tips="姓名填写有误";else rightOrWrong=!0;return a(e,rightOrWrong,$("#name-wrong-info"),tips),s("#submit-order",t,rightOrWrong),rightOrWrong}function p(){var e=$("#id-card"),i="",n=!1;if(""==b.stripSpaces(e[0])||void 0==e[0].value)i="请输入身份证号";else if(!b.idCardCheck(e[0].value))i="身份证号填写有误";else n=!0;return a(e,n,$("#idcard-wrong-info"),i),s("#submit-order",t,n),n}function h(){var e=$("#phone-number"),i="",n=!1;if(""==b.stripSpaces(e[0])||void 0==e[0])i="请输入联系手机";else if(!w.test(e[0].value))i="手机号填写有误";else n=!0;return a(e,n,$("#phone-wrong-info"),i),s("#submit-order",t,n),n}function m(){var e=$("#patient-id-card"),i="",n=!0,r=e[0].value;if(1==exports.needCard){if(""==r||void 0==r)n=!1,i="请输入就诊卡号";else if(!x.test(r)||!k.test(r))n=!1,i="就诊卡号填写有误";a(e,n,$("#patient-idcard-wrong-info"),i)}else if(2==exports.needCard)if(r&&"若有该医院就诊卡，请填写；若无，可到医院办理。"!=r){if(!x.test(r)||!k.test(r))n=!1,i="就诊卡号填写有误";a(e,n,$("#patient-idcard-wrong-info"),i)}else $("#patient-id-card").siblings("span").hide();return s("#submit-order",t,n),n}function g(){var e=$("#patient-id-card-password"),i="",n=!0,r=e.val();if(!r)n=!1,i="请输入就诊卡密码";return a(e,n,$("#patient-idcardpassword-wrong-info"),i),s("#submit-order",t,n),n}function v(){var e=$("#disease-name");if(/^\s*$/.test(e.val())||e.val().length>20)return $("#disease-name-wrong-info").show().prev().hide().next().find(".wrong-info").html("请填写所患疾病名字"),e.val(""),!1;else return $("#disease-name-wrong-info").hide().prev().show(),!0}function y(){var e=$("#condition"),i="",n=!0;if(""==e[0].value||void 0==e[0].value)i="请输入疾病描述",n=!1;if(n)e.parent().parent().find(".widget-instant-right-state").find(".right").show(),e.parent().parent().find(".widget-instant-wrong-state").find(".wrong").hide();else e.parent().parent().find(".widget-instant-right-state").find(".right").hide(),$("#dis-wrong-info").html(i),e.parent().parent().find(".widget-instant-wrong-state").find(".wrong").show();return s("#submit-order",t,n),n}var exports={};exports.img=[],exports.rsa=function(){var e="93b2b4a59fe63cdc1a65c6e006d2a710de3d8bcfe93cb601f1af2c49946b80dfa1e607195b0ee8969e24544153fc12b84acdfbba53949f0a0d6c6f665dce4c37",t="10001",i=130;return setMaxDigits(i),{encryptRsaKey:function(i){return encryptedString(new RSAKeyPair(t,"",e),i)}}}(),exports.href=function(){var e=$(".footer").data("href");return e}(),exports.api=function(){var e=$(".footer").data("api");return e}(),exports.passUrl=function(){var e=$(".footer").data("passport");return e}(),exports.getDoctorDetail=function(){var t=require("common/js/ajax");t({url:""+this.api+"/pc/doctor/detail",type:"GET",dataType:"json",data:{doctorId:this.doctorId,term:"pc"},success:function(t){this.doctorDetail=t.data,e(t.data)},error:function(){}})};var b=require("order/validate");exports.nowPatientList=[];var w=/^\+?(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/,x=/^[a-zA-Z0-9]+$/,k=/\d+/;return exports.addDomEvent=function(){var e=this;if("hdf"==e.siteFrom){$(".write-list").on("focus",'input[type="text"],textarea',function(){if("请选择"==$("#city-view").html())$(".city-wrong").show()}),$(".dropdown").on("click",function(){if($(".city-list").hide(),$(this).find("i").hasClass("fa-angle-down"))$(this).find("i").attr("class","fa fa-angle-up triangle-icon"),$(this).find(".city-list").show(),$(this).find("div").eq(0).css("z-index","200"),$(this).find(".bgWhite").css("height","34px");else $(this).find(".bgWhite").css("height","33px"),$(this).find("i").attr("class","fa fa-angle-down triangle-icon"),$(this).find("div").eq(0).css("z-index","0")}),$(".dropdown").hover(function(){},function(){$(this).find("i").attr("class","fa fa-angle-down triangle-icon"),$(".city-list").hide(),$(this).find("div").eq(0).css("z-index","0"),$(this).find(".bgWhite").css("height","33px")}),$("#province-list").delegate("li","click",function(){var t=$("#province-list li"),i=t.index($(this));if(this.currentSelectProvinceIndex!=i){var n=[];e.currentSelectProvinceIndex=i,$("#province-view").text(e.cityList[i].name),$("#city-view").text("请选择"),e.currentSelectCityIndex=-1,t.removeClass("currentSelect"),$(this).addClass("currentSelect");var a=e.cityList[i].children.length;for(e.currentSelectProvinceIndex=i;a--;)n.push('<li class="city-item">'+e.cityList[i].children[a].name+"</li>");n.reverse(),$("#city-list").html(n.join("")),$(".city-right").hide()}}),$("#city-list").delegate("li","click",function(){var t=$("#city-list li"),i=t.index($(this));if(this.currentSelectCityIndex!=i)e.currentSelectCityIndex=i,$("#city-view").text(e.cityList[e.currentSelectProvinceIndex].children[i].name),t.removeClass("currentSelect"),$(this).addClass("currentSelect"),$(".city-wrong").hide(),$(".city-right").show()}),$("#city-list, #province-list").delegate("li","mouseenter",function(){$(this).addClass("temporarySelect")}),$("#city-list, #province-list").delegate("li","mouseleave",function(){$(this).removeClass("temporarySelect")});var t=e.cityList.length,n=[],a=[];for(e.currentSelectProvinceIndex=-1,e.currentSelectCityIndex=-1;t--;)if(e.cityList[t].name==e.currentProvName){n.push('<li class="city-item currentSelect">'+e.cityList[t].name+"</li>"),$("#province-view").text(e.cityList[t].name);var o=e.cityList[t].children.length;for(e.currentSelectProvinceIndex=t;o--;)if(e.cityList[t].children[o].name==e.currentCityName)a.push('<li class="city-item currentSelect">'+e.cityList[t].children[o].name+"</li>"),$("#city-view").text(e.cityList[t].children[o].name),e.currentSelectCityIndex=o,$(".city-right").show();else a.push('<li class="city-item">'+e.cityList[t].children[o].name+"</li>");a.reverse(),$("#city-list").html(a.join(""))}else n.push('<li class="city-item">'+e.cityList[t].name+"</li>");n.reverse(),$("#province-list").html(n.join(""))}if($(".back-button").on("click",function(){if(""!=$(this).data("url"))window.location.href=$(this).data("url");else $(".popwin-info").hide()}),$(".fileupload li div .img").on("click",function(){}),$(".fileupload li div .delete").on("click",function(){$(this).parent().find(".img").attr("src",""),$(this).parent().hide(),e.img[$(this).data("index")].flag=!1}),$("#d_pic1").on("click",function(){localStorage.removeItem("pic1_small"),localStorage.removeItem("pic1_big"),delete exports.img[0]}),$("#d_pic2").on("click",function(){localStorage.removeItem("pic2_small"),localStorage.removeItem("pic2_big"),delete exports.img[1]}),$("#d_pic3").on("click",function(){localStorage.removeItem("pic3_small"),localStorage.removeItem("pic3_big"),delete exports.img[2]}),$("#d_pic4").on("click",function(){localStorage.removeItem("pic4_small"),localStorage.removeItem("pic4_big"),delete exports.img[3]}),$("#d_pic5").on("click",function(){localStorage.removeItem("pic5_small"),localStorage.removeItem("pic5_big"),delete exports.img[4]}),$("#file1, #file2, #file3, #file4, #file5").on("change",function(){var t=$(this).attr("id");$.ajaxFileUpload({url:""+e.api+"/pc/common/saveImage",secureuri:!1,fileElementId:$(this).attr("id"),type:"POST",dataType:"json",success:function(i){if(0==i.status)if(0==i.data.status){var n=t;e.img[n.charAt(n.length-1)-1]={},e.img[n.charAt(n.length-1)-1].smallImg=i.data.smallImg,e.img[n.charAt(n.length-1)-1].bigImg=i.data.bigImg,e.img[n.charAt(n.length-1)-1].flag=!0,$($(".fileupload div")[n.charAt(n.length-1)-1]).show(),$($(".img")[n.charAt(n.length-1)-1]).attr("src",i.data.smallImg),exports.img[n.charAt(n.length-1)-1].smallImg=i.data.smallImg,exports.img[n.charAt(n.length-1)-1].bigImg=i.data.bigImg}else{var a=i.data.statusInfo;$(".popwin-info p").html(a),$(".popwin-info input").val("确定").data("url",""),$(".popwin-info").show()}else $(".popwin-info p").html("图片上传失败，请重新尝试"),$(".popwin-info input").val("确定").data("url",""),$(".popwin-info").show()},error:function(e){$(".popwin-info p").html("图片上传失败，请重新尝试，图片最大为3.5M"),$(".popwin-info input").val("确定").data("url",""),$(".popwin-info").show()}})}),0==e.status||"edit"==e.op||0==e.nowPatientList.length)$("#patient-name").on("blur",function(){f()}),b.addInputEventListener("#patient-name",function(){var e=this.value;if(e.length>15)this.value=e.substr(0,15)}),$("#id-card").on("blur",function(){p()}),b.addInputEventListener("#id-card",function(){var e=this.value;if(!(e.length<18&&/^[0-9]*$/.test(e)))if(e.length<18)this.value=e.replace(/[^0-9]/g,"");else if(e.length>18)this.value=e.substr(0,18);else this.value=e.replace(/[^0-9x]$/i,"")});else b.addInputEventListener("#popwin-patient-name",function(){var e=this.value;if(e.length>15)this.value=e.substr(0,15)}),b.addInputEventListener("#popwin-id-card",function(){var e=this.value;if(!(e.length<18&&/^[0-9]*$/.test(e)))if(e.length<18)this.value=e.replace(/[^0-9]/g,"");else if(e.length>18)this.value=e.substr(0,18);else this.value=e.replace(/[^0-9x]$/i,"")});if("edit"!=exports.op)$("#arrow-up").on("click",function(){var e=$("#patient-list li:eq(1)").position().top;$("#patient-list li").filter(function(t){if($(this).position().top>e)$(this).hide()}).hide(),$("#arrow-down").show(),$(".card-person-add").show(),$(this).hide()}),$("#arrow-down").on("click",function(){$("#patient-list li").show(),$("#arrow-up").show(),$(this).hide()});if($("#phone-number").on("blur",function(){h()}),$("#phone-number").keypress(function(e){var t=[],n=e.which;for(i=48;i<58;i++)t.push(i);if(!Array.prototype.indexOf)Array.prototype.indexOf=function(e,t){for(var i=t||0,n=this.length;n>i;i++)if(this[i]===e)return i;return-1};if(!(t.indexOf(n)>=0||8==n||0==n))e.preventDefault()}),b.getInternetExplorerVersion()>=8)!function(){var e=$("#patient-id-card").data("value");$("#patient-id-card").val(e).css("color","#aaa"),$("#patient-id-card").on("focus",function(){if($(this).val()==e)$(this).val("").css("color","#000")}),$("#patient-id-card").on("blur",function(){if(""==$(this).val())$(this).val(e).css("color","#aaa")})}();$("#patient-id-card").on("blur",function(){m()}),$("#patient-id-card-password").on("blur",function(){g()}),$("#disease-name").on("blur",function(){v()}),$("#disease-name").on("keyup",function(){var e=this.value;if(e.length>20)$(this).val(e.substr(0,20)).next().hide().next().show().find(".wrong-info").html("所填疾病名称不能超过20字")});b.addInputEventListener("#patient-id-card",function(){this.value}),$("#condition").on("blur",function(){y()}),b.addInputEventListener("#condition",function(){b.txtrOverflow(this,300,$(this).parent().parent().find("p i"))}),$("#agreement").on("change",function(){}),$(".card-person-add").on("click",function(){$(".error-info").hide(),$(".popwin").show()}),$(".card-close").on("click",function(){$(".card-input input").val(""),$(".popwin").hide()}),$(".add_no").on("click",function(){$(".card-input input").val(""),$(".popwin").hide()}),$(".add_yes").on("click",function(){var t=$(".card-input input:eq(0)"),i=$(".card-input input:eq(1)");if(b.nameCheck(t[0])&&b.idCardCheck(i.val())){var n=require("common/js/ajax");n({url:""+e.api+"/pc/contacts/add",type:"POST",datatype:"json",async:!1,data:{name:$("#popwin-patient-name").val(),identification:$("#popwin-id-card").val()},success:function(e){if(0==e.status)$(".card-close").trigger("click"),r();else $(".error-info").show().html("<p>"+e.statusInfo+"</p>")},error:function(){$(".error-info").show().html("<p>请求失败！</p>")}})}else if($(".error-info").show(),""==t.val()&&""==i.val())$(".error-info").html("<p>用户名和身份证号不能为空！</p>");else if(""==t.val())$(".error-info").html("<p>用户名不能为空！</p>");else if(""==i.val())$(".error-info").html("<p>身份证号不能为空！</p>");else if(!b.nameCheck(t[0]))$(".error-info").html("<p>用户名输入有误！</p>");else $(".error-info").html("<p>身份证号输入有误！</p>")})},exports.init=function(e){if("edit"==this.op){if(1==exports.displayDisDesc){var i=$("#condition");b.txtrOverflow(i[0],300,i.parent().parent().find("p i"))}}else if($('input[type!="button"], textarea').val(""),$("#agreement").attr("checked",!0),d(),1==$(".top").data("login"))r();e&&o(e),$("#submit-order").addClass("action"),$("#submit-order").on("click",t)},exports});